@using Microsoft.AspNetCore.Mvc.Localization

@model Quintessence.QCandidate.Models.Assessments.Assessment

@inject IViewLocalizer Localizer

@section Scripts
{
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" />

    <style>
        .alertify .ajs-footer .ajs-buttons.ajs-primary .ajs-button {
            border-radius: 5px;
        }
    </style>    

    <script type="text/javascript">
        RefreshAllAssessments();

        function RefreshAllAssessments() {
            $.ajax({
                url: '@Url.Action("GetAllAssessments")',
                cache: false,
                success: function (html) {
                    $('#allassessments').html(html);
                }
            });
        }
    </script>
}

@{

    var language = User.Claims.SingleOrDefault(c => c.Type == "extension_Language").Value.ToLower();
    System.Threading.Thread.CurrentThread.CurrentUICulture = System.Globalization.CultureInfo.GetCultureInfo(language);
    System.Threading.Thread.CurrentThread.CurrentCulture = System.Globalization.CultureInfo.GetCultureInfo(language);

    if (Model != null)
    {
        <div class="container">
            <div class="context">
                <span class="company">@Model.CustomerName</span> <span class="project">@Model.PositionName</span>
                <h1>@Model.Date.ToLongDateString()</h1>
                <span class="location">@Model.LocationName</span>
            </div>

            @*<div class="assessment-context">
                    <h2>Assessment context</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam et scelerisque tortor. Donec vel aliquam tortor. Sed suscipit tortor eu enim condimentum condimentum. Nulla egestas arcu nec nunc suscipit, eu semper odio lobortis. Maecenas at dolor sit amet quam ultrices mattis. Nam eleifend, ligula at vestibulum bibendum, lectus neque consequat tellus, id malesuada nunc est non dolor. Sed non sagittis dui. Vivamus ullamcorper ultrices magna id vehicula. Praesent quis molestie sapien.</p>
                </div>*@
        </div>


        <div class="container calendar-wrap">
            <ul class="timeline">
                @foreach (var programComponent in Model.ProgramComponents)
                {
                    @Html.DisplayFor(m => programComponent)
                }
            </ul>
        </div>

        <div class="modal fade" id="modalPrepWarning" role="dialog" style="background-color: transparent; max-height: none;">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-body" style="text-align:center;">
                        <p>@Localizer["SimulationStart"]</p>
                        <p id="labelPrep"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            var items = @Json.Serialize(Model.ProgramComponents);
            var interval = setInterval(function () { myFunction(); }, 60000);

            function myFunction() {

                var today = new Date();
                var now = today.getHours() + ':' + today.getMinutes();

                for (var i = 0; i < items.length; i++) {
                    if (items[i].title.indexOf("voorbereiding") >= 1 || items[i].title.indexOf("préparation") >= 1 || items[i].title.indexOf("preparation") >= 1) {
                        var l = items[i].start.length;
                        var st = items[i].start.substr(l - 8, 5);
                        if (st === now) {
                            $('#labelPrep').text(items[i].title);
                            //$("#modalPrepWarning").modal();
                            alertify.alert('@Localizer["SimulationStart"]').set({ title: "" });
                        }
                    }
                }
            }
        </script>
    }
    else
    {

        <div class="container">
            <div class="row">
                <div class="col-md-12 center" style="margin-top: 10%;">
                    @Localizer["WelcomeQCandidate"]
                    @Localizer["WelcomeMessage"]
                </div>
            </div>

            <div id="allassessments"></div>
        </div>

        <div style="margin-top: 135px;">
            <img src="https://qcandidate-demo.quintessenceconsulting.be/img/digitalhr.jpg" style="width: 100%;" />
        </div>
    }
}