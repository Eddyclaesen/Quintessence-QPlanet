@model Quintessence.QService.QueryModel.Sec.RoleView
@{
    Layout = "~/Views/Shared/_DetailLayout.cshtml";
    ViewBag.Title = "Admin - Users - Role";
}
@section DetailAreaNavigation
{
    <nav class="area">
        <ul>
            <li class="current"><a href="javascript:void(0);">@Model.Name</a></li>
        </ul>
    </nav>
}
@section DetailActionNavigation
{
    <nav class="action">
        <ul>
            <li class="current">Detail</li>
        </ul>
    </nav>
}
@section AdditionalScripts
{
    <script src="@Url.Content("~/Scripts/jquery.dataTables.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            InitializeButtons();

            RefreshUsersInRole();
            RefreshOperationsInRole();
        });
        
        function InitializeButtons() {
            $(this).on('click', 'a[data-function=RefreshRoleUsers]', null, function (event) {
                RefreshUsersInRole();
            });
        }
        
        function RefreshUsersInRole() {
            $('#UsersInRolePlaceholder').loading('Retrieving users in this role.');
            $.ajax({
                url: '@Url.Action("UsersInRole", new{id = Model.Id})',
                success: function (html) {
                    $('#UsersInRolePlaceholder').html(html);
                    $('#UsersInRoleTable').dataTable();
                },
                error: function (err) {
                    ShowDetailErrorDialog('Retrieve users in this role.', err);
                    $('#UsersPlaceholder').html('Error retrieving users. Please contact your system administrator if this problems persists.');
                }
            });
        }
        
        function RefreshOperationsInRole() {
            $('#OperationsInRolePlaceholder').loading('Retrieving operations in this role.');
            $.ajax({
                url: '@Url.Action("OperationsInRole", new{id = Model.Id})',
                success: function (html) {
                    $('#OperationsInRolePlaceholder').html(html);
                    $('#OperationsInRoleTable').dataTable();
                },
                error: function (err) {
                    ShowDetailErrorDialog('Retrieve users in this role.', err);
                    $('#OperationsPlaceholder').html('Error retrieving operation. Please contact your system administrator if this problems persists.');
                }
            });
        }
    </script>
}

<div class="grid_8">
    <fieldset>
        <legend>Role details</legend>

        <p>The following information is readonly and can't be changed.</p>

        <div class="row">
            <div>Name</div>
            <div>@Html.TextBoxFor(m => m.Name, new { @readonly = "readonly" })</div>
        </div>

        <div class="row">
            <div>Description</div>
            <div>@Html.TextAreaFor(m => m.Description, 5, 50, new { @readonly = "readonly" })
            </div>
        </div>
    </fieldset>
</div>

<div class="grid_8">
    <fieldset>
        <legend>Users</legend>
        
        <div id="UsersInRolePlaceholder"></div>
    </fieldset>
</div>

<div class="clear"></div>

<div class="grid_8">
    <fieldset>
        <legend>Operations</legend>

        <p>The following information is readonly and can't be changed.</p>
        
        <div id="OperationsInRolePlaceholder"></div>
    </fieldset>
</div>