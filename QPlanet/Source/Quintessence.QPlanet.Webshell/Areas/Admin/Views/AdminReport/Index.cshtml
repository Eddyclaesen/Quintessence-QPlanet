@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Admin - Reporting";
}

@section LeftNavigation
{
    <ul id="Tabs">
        <li><a href="#Report"></a></li>
        <li><a href="#CandidateReport"></a></li>
    </ul>
}
@section AdditionalScripts
{
    <script src="@Url.Content("~/Scripts/jquery.dataTables.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.treeTable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.cookie.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/persist.js")" type="text/javascript"></script>
    <script>
        $(function () {
            InitializeAddReportDefinitionDialog();
            InitializeAddCandidateReportDefinitionDialog();
            InitializeEditCandidateReportDefinitionDialog();
            InitializeAddCandidateReportDefinitionFieldDialog();
            InitializeEditCandidateReportDefinitionFieldDialog();

            InitializeButtons();

            RefreshReportDefinitionTable();
            RefreshCandidateReportDefinitionTable();
        });

        function RefreshReportDefinitionTable() {
            $.ajax({
                url: '@Url.Action("ReportDefinitions")',
                success: function (html) {
                    $('#ReportDefinitionPlaceholder').html(html);
                    $('#ReportDefinitionTable').treeTable({ persist: true });
                }
            });
        }

        function RefreshCandidateReportDefinitionTable() {
            $.ajax({
                url: '@Url.Action("CandidateReportDefinitions")',
                success: function (html) {
                    $('#CandidateReportDefinitionPlaceholder').html(html);
                    $('#CandidateReportDefinitionTable').treeTable({ persist: true });
                }
            });
        }

        function InitializeButtons() {
            $('#AddReportDefinitionButton').click(function () {
                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("AddReportDefinition")',
                    success: function (html) {
                        $('#AddReportDefinitionDialog').html(html);
                        HideDetailSaveDialog();
                        $('#AddReportDefinitionDialog').dialog('open');
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });
            
            $('#AddCandidateReportDefinitionButton').click(function () {
                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("AddCandidateReportDefinition")',
                    success: function (html) {
                        $('#AddCandidateReportDefinitionDialog').html(html);
                        HideDetailSaveDialog();
                        $('#AddCandidateReportDefinitionDialog').dialog('open');
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#SubmitAddReportDefinitionForm', null, function () {
                $('#AddReportDefinitionDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#AddReportDefinitionForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#SubmitAddCandidateReportDefinitionForm', null, function () {
                $('#AddCandidateReportDefinitionDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#AddCandidateReportDefinitionForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshCandidateReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshCandidateReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=AddCustomerCandidateReportDefinition]', null, function () {
                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("AddCandidateReportDefinition")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#AddCandidateReportDefinitionDialog').html(html);
                        HideDetailSaveDialog();
                        $('#AddCandidateReportDefinitionDialog').dialog('open');
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

                $(this).on('click', 'a[data-function=EditCandidateReportDefinition]', null, function () {
                    ShowDetailSaveDialog();

                    $.ajax({
                        url: '@Url.Action("EditCandidateReportDefinition")/' + $(this).attr('data-id'),
                        success: function (html) {
                            $('#EditCandidateReportDefinitionDialog').html(html);
                            HideDetailSaveDialog();
                            $('#EditCandidateReportDefinitionDialog').dialog('open');
                        },
                        error: function (err) {
                            HideDetailSaveDialog();
                            alert(err.statusText);
                        }
                    });
                });

                $(this).on('click', '#SubmitEditCandidateReportDefinitionForm', null, function () {
                    $('#EditCandidateReportDefinitionDialog').dialog('close');

                    ShowDetailSaveDialog();

                    var form = $('#EditCandidateReportDefinitionForm');
                    $.ajax({
                        url: form.attr('action'),
                        type: 'POST',
                        data: form.serialize(),
                        dataType: 'JSON',
                        success: function () {
                            HideDetailSaveDialog();
                            RefreshCandidateReportDefinitionTable();
                        },
                        error: function (err) {
                            RefreshCandidateReportDefinitionTable();
                            alert(err.statusText);
                        }
                    });
                });

                $(this).on('click', 'a[data-function=DeleteCandidateReportDefinition]', null, function () {
                    if (!confirm('Are you sure you want to delete this report definition?'))
                        return;

                    ShowDetailSaveDialog();

                    $.ajax({
                        url: '@Url.Action("DeleteCandidateReportDefinition")/' + $(this).attr('data-id'),
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshCandidateReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshCandidateReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=AddCandidateReportDefinitionField]', null, function () {
                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("AddCandidateReportDefinitionField")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#AddCandidateReportDefinitionFieldDialog').html(html);
                        HideDetailSaveDialog();
                        $('#AddCandidateReportDefinitionFieldDialog').dialog('open');
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#SubmitAddCandidateReportDefinitionFieldForm', null, function () {
                $('#AddCandidateReportDefinitionFieldDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#AddCandidateReportDefinitionFieldForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshCandidateReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshCandidateReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=EditCandidateReportDefinitionField]', null, function () {
                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("EditCandidateReportDefinitionField")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#EditCandidateReportDefinitionFieldDialog').html(html);
                        HideDetailSaveDialog();
                        $('#EditCandidateReportDefinitionFieldDialog').dialog('open');
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#SubmitEditCandidateReportDefinitionFieldForm', null, function () {
                $('#EditCandidateReportDefinitionFieldDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#EditCandidateReportDefinitionFieldForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshCandidateReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshCandidateReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=DeleteCandidateReportDefinitionField]', null, function () {
                if (!confirm('Are you sure you want to delete this report definition field?'))
                    return;

                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("DeleteCandidateReportDefinitionField")/' + $(this).attr('data-id'),
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshCandidateReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshCandidateReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $("#SaveReportDefinitionsButton").click(function () {
                var form = $('#ReportDefinitionForm');

                ShowDetailSaveDialog();

                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshReportDefinitionTable();
                    },
                    error: function (err) {
                        RefreshReportDefinitionTable();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=DeleteReportDefinition]', null, function (event) {
                event.preventDefault();
                
                if (!confirm('Are you sure you want to delete this report definition?'))
                    return;

                ShowDetailSaveDialog();

                $.ajax({
                    url: '@Url.Action("DeleteReportDefinition")/' + $(this).attr('data-id'),
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshReportDefinitionTable();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        ShowDetailErrorDialog('Delete report definition', err);
                        RefreshReportDefinitionTable();
                    }
                });
            });
        }

        function InitializeAddReportDefinitionDialog() {
            $('#AddReportDefinitionDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 350,
                    title: 'Add new report definition'
                });
        }

        function InitializeAddCandidateReportDefinitionDialog() {
            $('#AddCandidateReportDefinitionDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 350,
                    title: 'Add new report definition'
                });
        }

        function InitializeEditCandidateReportDefinitionDialog() {
            $('#EditCandidateReportDefinitionDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 350,
                    title: 'Edit report definition'
                });
        }

        function InitializeAddCandidateReportDefinitionFieldDialog() {
            $('#AddCandidateReportDefinitionFieldDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 250,
                    title: 'Add new report definition field'
                });
        }

        function InitializeEditCandidateReportDefinitionFieldDialog() {
            $('#EditCandidateReportDefinitionFieldDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 300,
                    title: 'Edit report definition field'
                });
        }
    </script>
}

<fieldset id="Report">
    <legend>Reporting</legend>

    @using (Html.BeginForm("ReportDefinitions", "AdminReport", FormMethod.Post, new { id = "ReportDefinitionForm" }))
    {
        <div id="ReportDefinitionPlaceholder"></div>
    }

    <br />
    <br />
    <div class="right-text">
        <a href="javascript:void(0);" id="SaveReportDefinitionsButton" class="button">Save</a>
        <a href="javascript:void(0);" id="AddReportDefinitionButton" class="button">Add</a>
    </div>
</fieldset>

<fieldset id="CandidateReport">
    <legend>Candidate reporting</legend>

    <div id="CandidateReportDefinitionPlaceholder"></div>

    <br />
    <br />
    <div class="right-text">
        <a href="javascript:void(0);" id="AddCandidateReportDefinitionButton" class="button">
            Add</a>
    </div>
</fieldset>

<div id="AddReportDefinitionDialog">
</div>

<div id="AddCandidateReportDefinitionDialog">
</div>

<div id="EditCandidateReportDefinitionDialog">
</div>

<div id="AddCandidateReportDefinitionFieldDialog">
</div>

<div id="EditCandidateReportDefinitionFieldDialog">
</div>
