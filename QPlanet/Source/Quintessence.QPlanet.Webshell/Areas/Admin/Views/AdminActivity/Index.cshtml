@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Admin - Activities";
}

@section LeftNavigation
{
    <ul id="Tabs">
        <li><a href="#ActivityTypes"></a></li>
        <li><a href="#Profiles"></a></li>
        <li><a href="#ProductTypes"></a></li>
    </ul>
}
@section AdditionalScripts
{
    <script src="@Url.Content("~/Scripts/jquery.dataTables.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.treeTable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.cookie.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/persist.js")" type="text/javascript"></script>
    <script>
        $(function () {
            ShowDetailSaveDialog();

            InitializeButtons();

            RefreshActivityTypes();
            RefreshProfiles();
            RefreshProductTypes();

            InitializeIndexActivityTypesDialog();
            InitializeAddActivityTypeDialog();
            InitializeEditActivityTypeDialog();
            InitializeAddActivityTypeProfileDialog();
            InitializeEditActivityTypeProfileDialog();
            InitializeCreateProfileDialog();
            InitializeEditProfileDialog();

            HideDetailSaveDialog();
        });

        function InitializeButtons() {
            $('#IndexRatesButton').click(function () {
                $('#IndexActivityTypesDialog').html('');
                $.ajax({
                    url: '@Url.Action("ApplyPriceIndex")',
                    success: function (html) {
                        $('#IndexActivityTypesDialog').html(html);
                        $('#IndexActivityTypesDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#SubmitIndexAmountButton', null, function () {
                $('#IndexActivityTypesDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#IndexActivityTypesForm');

                $.ajax({
                    url: '@Url.Action("ApplyPriceIndex")',
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $('#AddActivityTypes').click(function () {
                $('#AddActivityTypeDialog').html('');
                $.ajax({
                    url: '@Url.Action("AddActivityType")',
                    success: function (html) {
                        $('#AddActivityTypeDialog').html(html);
                        $('#AddActivityTypeDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $('#CreateNewProfile').click(function () {
                $('#CreateProfileDialog').html('');
                $('#CreateProfileDialog').load('@Url.Action("CreateProfile")', function () {
                    $('#CreateProfileDialog').dialog('open');
                });
                
            });
            
            $('#CreateProductType').click(function () {
                //TODO: Go to ProductType Create page
            });

            $(this).on('click', '#AddActivityTypeButton', null, function () {
                $('#AddActivityTypeDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#AddActivityTypeForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#CreateProfileSubmitButton', null, function () {
                $('#CreateProfileDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#CreateProfileForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshProfiles();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=EditActivityTypeButton]', null, function () {
                $('#EditActivityTypeDialog').html('');
                $.ajax({
                    url: '@Url.Action("EditActivityType")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#EditActivityTypeDialog').html(html);
                        $('#EditActivityTypeDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#EditActivityTypeButton', null, function () {
                $('#EditActivityTypeDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#EditActivityTypeForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=DeleteActivityTypeButton]', null, function () {
                
                if (!confirm('Are you sure you want to delete this activity type?'))
                    return;

                ShowDetailSaveDialog();
                
                $.ajax({
                    url: '@Url.Action("DeleteActivityType")/' + $(this).attr('data-id'),
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=AddActivityTypeProfile]', null, function () {
                $('#AddActivityTypeProfileDialog').html('');
                $.ajax({
                    url: '@Url.Action("AddActivityTypeProfile")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#AddActivityTypeProfileDialog').html(html);
                        $('#AddActivityTypeProfileDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#AddActivityTypeProfileButton', null, function () {
                var form = $('#AddActivityTypeProfileForm');

                if (form.validate().form()) {

                $('#AddActivityTypeProfileDialog').dialog('close');

                ShowDetailSaveDialog();

                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
                }
            });

            $(this).on('click', 'a[data-function=EditActivityTypeProfile]', null, function () {
                $('#EditActivityTypeProfileDialog').html('');
                $.ajax({
                    url: '@Url.Action("EditActivityTypeProfile")/' + $(this).attr('data-id'),
                    success: function (html) {
                        $('#EditActivityTypeProfileDialog').html(html);
                        $('#EditActivityTypeProfileDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', 'a[data-function=EditProfile]', null, function () {
                $('#EditProfileDialog').html('');
                $.ajax({
                    url: '@Url.Action("EditProfile")/' + $(this).attr('data-profile-id'),
                    success: function (html) {
                        $('#EditProfileDialog').html(html);
                        $('#EditProfileDialog').dialog('open');
                    },
                    error: function (err) {
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#EditActivityTypeProfileButton', null, function () {
                $('#EditActivityTypeProfileDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#EditActivityTypeProfileForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });

            $(this).on('click', '#EditProfileSubmitButton', null, function () {
                $('#EditProfileDialog').dialog('close');

                ShowDetailSaveDialog();

                var form = $('#EditProfileForm');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    dataType: 'JSON',
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshProfiles();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });
            $(this).on('click', 'a[data-function=DeleteActivityTypeProfile]', null, function () {
                
                if (!confirm('Are you sure you want to delete this profile from the activity type?'))
                    return;

                ShowDetailSaveDialog();
                
                $.ajax({
                    url: '@Url.Action("DeleteActivityTypeProfile")/' + $(this).attr('data-id'),
                    success: function () {
                        HideDetailSaveDialog();
                        RefreshActivityTypes();
                    },
                    error: function (err) {
                        HideDetailSaveDialog();
                        alert(err.statusText);
                    }
                });
            });
            
        }

        function RefreshActivityTypes() {
            $('#ActivityTypePlaceholder').loading('Loading activity types...');
            $('#ActivityTypePlaceholder').load('@Url.Action("ActivityTypes")');
        }
        
        function RefreshProfiles() {
            $('#ProfilesPlaceholder').loading('Loading profiles...');
            $('#ProfilesPlaceholder').load('@Url.Action("Profiles")', function () {
                $('#ProfilesDataTable').dataTable({ "bStateSave": true });
            });
        }

        function RefreshProductTypes() {
            $('#ProductTypesPlaceholder').loading('Loading product types...');
            $('#ProductTypesPlaceholder').load('@Url.Action("ProductTypes")', function () {
                $('#ProductTypesDataTable').dataTable({ "bStateSave": true });
            });
        }
        
        function InitializeIndexActivityTypesDialog() {
            $('#IndexActivityTypesDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 225,
                    title: 'Adjust all prices using an index'
                });
        }

        function InitializeAddActivityTypeDialog() {
            $('#AddActivityTypeDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 225,
                    title: 'Add new activity type'
                });
        }

        function InitializeEditActivityTypeDialog() {
            $('#EditActivityTypeDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 225,
                    title: 'Edit activity type'
                });
        }

        function InitializeAddActivityTypeProfileDialog() {
            $('#AddActivityTypeProfileDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 350,
                    title: 'Add new profile to activity type'
                });
        }

        function InitializeEditActivityTypeProfileDialog() {
            $('#EditActivityTypeProfileDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 500,
                    height: 225,
                    title: 'Edit profile for activity'
                });
        }
        
        function InitializeCreateProfileDialog() {
            $('#CreateProfileDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 350,
                    height: 180,
                    title: 'Create new profile'
                });
        }

        function InitializeEditProfileDialog() {
            $('#EditProfileDialog').dialog(
                {
                    autoOpen: false,
                    modal: true, resizable: false,
                    width: 350,
                    height: 180,
                    title: 'Edit profile'
                });
        }
    </script>
}

<fieldset id="ActivityTypes">
    <legend>Activity types</legend>

    <div id="ActivityTypePlaceholder"></div>

    <div class="right-text">
        <a href="javascript:void(0);" id="AddActivityTypes" title="Add a new activity type"
            class="button">Add</a>
        <a href="javascript:void(0);" id="IndexRatesButton" title="Adjust all prices using an index"
            class="button">Index</a>
    </div>
</fieldset>

<fieldset id="Profiles">
    <legend>Profiles</legend>
    <div id="ProfilesPlaceholder"></div>
    <br/>
    <br/>
    <div class="right-text">
        <a href="javascript: void;" id="CreateNewProfile" class="button">Create</a>
    </div>
</fieldset>

<fieldset id="ProductTypes">
    <legend>Product types</legend>
    <div id="ProductTypesPlaceholder"></div>
    <br/>
    <br/>
    <div class="right-text">
        @Html.ActionLink("Create", "CreateProductType", "AdminActivity", new{area="Admin"}, new { target = "_blank", data_id = "CreateProductType", @class = "button" })        
    </div>
</fieldset>

<div id="IndexActivityTypesDialog">
</div>

<div id="AddActivityTypeDialog">
</div>

<div id="EditActivityTypeDialog">
</div>

<div id="AddActivityTypeProfileDialog">
</div>

<div id="EditActivityTypeProfileDialog">
</div>

<div id="CreateProfileDialog">
</div>

<div id="EditProfileDialog">
</div>
